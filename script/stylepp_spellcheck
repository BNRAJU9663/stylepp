DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PID=$BASHPID
PATH=$PATH:$DIR/../bin:$DIR

echo > /tmp/code.$PID
echo > /tmp/comment.$PID
for I in `find -regex ".*[.][ch]\$"`; do
  stylepp_extract_code $I < $I >> /tmp/code.$PID
  stylepp_extract_comment $I < $I >> /tmp/comment.$PID
done

# Now we find words in comments but not in code
cat /tmp/code.$PID    | stylepp_sortuniq | aspell list | stylepp_sortuniq> /tmp/code2.$PID
cat /tmp/comment.$PID | stylepp_sortuniq | aspell list | stylepp_sortuniq> /tmp/comment2.$PID

# This can take while so it is better to save it to file for users which forget
# to redirect this.

stylepp_symdiff /tmp/comment2.$PID /tmp/code2.$PID | grep -v "[[:upper:]]" | aspell list > /tmp/misspells
cat /tmp/misspells

echo "Also saved into /tmp/misspells file"

# Cleanup.
rm /tmp/code.$PID
rm /tmp/comment.$PID
#rm /tmp/code2.$PID
#rm /tmp/comment2.$PID
